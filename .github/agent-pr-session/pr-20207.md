# PR Review: #20207 - [iOS] Fixed auto picker resizing after selection

**Date:** 2026-01-09 | **Issue:** [#19295](https://github.com/dotnet/maui/issues/19295) | **PR:** [#20207](https://github.com/dotnet/maui/pull/20207)

## âœ… Final Recommendation: APPROVE

| Phase | Status |
|-------|--------|
| Pre-Flight | âœ… COMPLETE |
| ğŸ§ª Tests | âœ… COMPLETE |
| ğŸš¦ Gate | âœ… PASSED |
| ğŸ”§ Fix | âœ… COMPLETE |
| ğŸ“‹ Report | âœ… COMPLETE |

---

<details>
<summary><strong>ğŸ“‹ Issue Summary</strong></summary>

**Bug**: iOS Picker does not resize automatically after selecting a longer item. The picker box remains the original width and truncates longer strings.

**Steps to Reproduce:**
1. Create .NET MAUI app with Picker
2. Set Title to short string (e.g., "test")
3. Add items with longer strings (e.g., "Japanese Macaque")
4. Run on iOS
5. Select longer item and tap "Done"
6. Observe: Picker box not resized, text truncated

**Expected**: Picker should resize to display full text (matches Android/Windows behavior)

**Workaround**: Disable and re-enable Picker after selection to force redraw

**Platforms Affected:**
- [x] iOS
- [ ] Android
- [ ] Windows
- [ ] MacCatalyst (not confirmed, likely same as iOS)

**Regression**: Unknown

**Reproduction**: https://github.com/Quaybe/iOS-Picker-Bug

</details>

<details>
<summary><strong>ğŸ“ Files Changed</strong></summary>

| File | Type | Changes |
|------|------|---------|
| `src/Core/src/Platform/iOS/PickerExtensions.cs` | Fix | +2 lines |
| `src/Controls/tests/TestCases.HostApp/Issues/Issue19295.xaml` | Test (HostApp) | +13 lines (new) |
| `src/Controls/tests/TestCases.HostApp/Issues/Issue19295.xaml.cs` | Test (HostApp) | +13 lines (new) |
| `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/Issue19295.cs` | Test (NUnit) | +39 lines (new) |
| `src/TestUtils/src/UITest.Appium/HelperExtensions.cs` | Test Helper | +19 lines (new method) |
| `src/Controls/tests/TestCases.Shared.Tests/UITest.cs` | Test Config | Â±12 lines (formatting + hardcoded iOS version) |

</details>

<details>
<summary><strong>ğŸ’¬ PR Discussion Summary</strong></summary>

**Key Comments:**
- PR opened Jan 28, 2024 (2 years old, still open)
- Author added UI test on Jan 30, 2024
- Community member (ScottAtBrady) requested merge June 4, 2024 and July 19, 2024
- Multiple CI runs triggered by jsuarezruiz
- Last activity: July 19, 2024

**Reviewer Feedback (Inline Comments):**

1. **StepKie** (Code Review):
   - File: `PickerExtensions.cs:69` â†’ Typo: "Messure" â†’ "Measure" (now in comment)
   - Suggested inlining condition, but author responded correctly that `newSelectedIndex` may be null

2. **StepKie** (Code Review):
   - File: `PickerExtensions.cs:44` â†’ Empty suggestion (approved change)

3. **Copilot** (Automated Review):
   - File: `Issue19295.cs:26` â†’ Test missing step to dismiss picker after SendKeys
   - Suggests adding `App.TapCoordinates(10, 10)` to dismiss picker before measuring width
   - **This was NOT addressed by the author**

**Disagreements Investigated:**
| File:Line | Reviewer Says | Resolution |
|-----------|---------------|------------|
| Issue19295.cs:26 | Copilot suggested `TapCoordinates(10,10)` to dismiss picker | âœ… **NOT NEEDED**: Current approach (`App.Tap("Done")`) correctly dismisses picker and passes Gate verification |

**Author Uncertainty:**
- None explicitly stated

**Edge Cases:**
- [ ] Does fix work when picker is in different layout contexts?
- [ ] Does fix work with different HorizontalOptions?
- [ ] Performance impact of InvalidateMeasure on every selection?

**Test Configuration Change:**
- UITest.cs hardcodes iOS 18.5 / iPhone Xs (was environment variable-based)
- This may be intentional for consistency or accidental commit

</details>

<details>
<summary><strong>ğŸ§ª Tests</strong></summary>

**Status**: âœ… COMPLETE

- [x] PR includes UI tests
- [x] Tests compile successfully
- [x] Tests follow naming convention (`Issue19295`)
- [x] Tests verified to reproduce bug (Phase 3: Gate) âœ…

**Test Files:**
- HostApp: `src/Controls/tests/TestCases.HostApp/Issues/Issue19295.xaml[.cs]`
- NUnit: `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/Issue19295.cs`

**Test Approach:**
1. Measure picker width with short item selected
2. Tap picker, select longer item ("Japanese Macaque")
3. Tap "Done" to dismiss picker
4. Assert: final width > initial width

**Test Helper Added:**
- `SelectPickerWheelValue()` - iOS-specific helper to select picker wheel value

</details>

<details>
<summary><strong>ğŸš¦ Gate - Test Verification</strong></summary>

**Status**: âœ… PASSED

- [x] Tests FAIL without fix (bug reproduced) âœ…
- [x] Tests PASS with fix (bug fixed) âœ…

**Result:** PASSED âœ…

**Verification Details:**
- WITHOUT fix: Test failed with "Picker width should increase when selecting longer item. Initial: 65, Final: 65"
- WITH fix: Test passed - picker correctly resized to accommodate longer text

</details>

<details>
<summary><strong>ğŸ”§ Fix Candidates</strong></summary>

**Status**: âœ… COMPLETE

| # | Source | Approach | Test Result | Files Changed | Notes |
|---|--------|----------|-------------|---------------|-------|
| PR | PR #20207 | Add `picker.InvalidateMeasure()` after picker selection update | âœ… PASS (Gate) | `PickerExtensions.cs` (+2) | Original PR - simple, direct fix. Validated by Gate. |

**Independent Analysis (Phase 4):**

After reviewing the bug and PR's approach, alternative fix ideas considered:

1. **Event-based approach** (listener on text changes)
   - âŒ **Not pursued**: More complex, requires adding state management and lifecycle handling
   - Would need to track selection changes and trigger resize
   - PR's approach (direct `InvalidateMeasure()` call) is simpler and more direct

2. **Native UIKit approach** (`setNeedsLayout()` / `layoutIfNeeded()`)
   - âŒ **Not pursued**: Breaks platform abstraction, MAUI provides `InvalidateMeasure()` as cross-platform API
   - PR's approach uses proper MAUI abstraction

3. **Timer-based deferred resize**
   - âŒ **Not pursued**: Unreliable, creates race conditions, poor UX (visible delay)
   - PR's approach is immediate and synchronous

**Conclusion**: PR's fix (`picker.InvalidateMeasure()`) is the **optimal solution** because:
- âœ… **Simplest possible fix** - Single line, no new state or complexity
- âœ… **Uses correct MAUI pattern** - `InvalidateMeasure()` is the standard way to request layout recalculation
- âœ… **Minimal blast radius** - Only affects iOS Picker, placed at the right hook point (after selection update)
- âœ… **Matches similar fixes** - Same pattern used throughout MAUI codebase for dynamic sizing

**Exhausted:** Yes - no viable alternatives simpler or better than PR's approach
**Selected Fix:** PR's fix - optimal solution

</details>

---

## ğŸ“‹ Final Report Summary

**Review Completed:** 2026-01-09  
**Recommendation:** âœ… **APPROVE**

### Key Findings

1. **Fix Quality**: Optimal solution - single line using correct MAUI pattern (`InvalidateMeasure()`)
2. **Test Coverage**: Excellent - UI tests properly reproduce bug and verify fix
3. **Gate Verification**: âœ… PASSED - Tests FAIL without fix (width=65), PASS with fix (width increases)
4. **Alternative Analysis**: No simpler or better solution exists than PR's approach

### Minor Issues (Non-Blocking)

1. **UITest.cs changes**: Hardcoded iOS 18.5/iPhone Xs (line 70-71) - recommend reverting to environment variables
2. **PR age**: 2 years old - may need rebase against current main

### Recommendation

**APPROVE** - This is an excellent, minimal fix for a real user issue with proper test coverage. The 2-year wait is unfortunate given the quality.

**Next Steps:**
1. Request author revert `UITest.cs` test configuration changes
2. Rebase against current `main`
3. Trigger CI re-run
4. Merge
