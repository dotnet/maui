# PR Review: #33359 - [Android] Fix NavigationBar overlapping StatusBar when NavigationBar visibility changes

**Date:** 2026-01-07 | **Issue:** [#33340](https://github.com/dotnet/maui/issues/33340) | **PR:** [#33359](https://github.com/dotnet/maui/pull/33359)

## âœ… Final Recommendation: APPROVE

| Phase | Status |
|-------|--------|
| Pre-Flight | âœ… COMPLETE |
| ğŸ§ª Tests | âœ… COMPLETE |
| ğŸš¦ Gate | âœ… PASSED |
| ğŸ”§ Fix | âœ… COMPLETE |
| ğŸ“‹ Report | âœ… COMPLETE |

---

<details>
<summary><strong>ğŸ“‹ Issue Summary</strong></summary>

On Android, the NavigationBar overlaps the StatusBar in a TabbedPage when tabs use mixed HasNavigationBar values (true/false). The issue occurs when the tab with `HasNavigationBar="true"` is NOT the initially selected tab and user switches to that tab for the first time.

**Regression**: Introduced in PR #27294 (added OffscreenPageLimit which pre-creates tab fragments)

**Steps to Reproduce:**
1. Create a TabbedPage with 4 NavigationPage children
2. Set HasNavigationBar="false" on Tab 1-3
3. Set HasNavigationBar="true" on Tab 4
4. Set Tab 1 as the initial CurrentPage
5. Run on Android 15 (API 35)
6. Switch to Tab 4

**Expected**: NavigationBar positioned below StatusBar with proper spacing
**Actual**: NavigationBar overlaps with StatusBar

**Additional Issue Found**: When navigating from tab with HasNavigationBar=true back to tab with HasNavigationBar=false, StatusBar color doesn't reset (should be transparent).

**Platforms Affected:**
- [ ] iOS
- [x] Android
- [ ] Windows
- [ ] MacCatalyst

</details>

<details>
<summary><strong>ğŸ“ Files Changed</strong></summary>

| File | Type | Changes |
|------|------|---------|
| `src/Controls/src/Core/Platform/Android/Extensions/ToolbarExtensions.cs` | Fix | +1 line |
| `src/Core/src/Platform/Android/MauiWindowInsetListener.cs` | Fix | +2/-2 lines |
| `src/Controls/tests/TestCases.HostApp/Issues/Issue33340.cs` | Test | +31 lines |
| `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/Issue33340.cs` | Test | +23 lines |
| `src/Controls/tests/TestCases.Android.Tests/snapshots/android/NavigationBarLayoutWithMixedHasNavigationBar.png` | Test | snapshot |
| `src/Controls/tests/TestCases.iOS.Tests/snapshots/ios/NavigationBarLayoutWithMixedHasNavigationBar.png` | Test | snapshot |

</details>

<details>
<summary><strong>ğŸ’¬ PR Discussion Summary</strong></summary>

**Key Comments:**
- PR author describes root cause: OffscreenPageLimit pre-creates tab fragments, Android's insets system doesn't recalculate when switching tabs with different HasNavigationBar values
- Author references similar patterns in ContentViewGroup.cs, LayoutViewGroup.cs, MauiScrollView.cs

**Reviewer Feedback:**
- Copilot flagged: Test uses `App.WaitForElement("Tab4")` but HostApp code doesn't set AutomationId properties on NavigationPage tabs

**Disagreements to Investigate:**
| File:Line | Reviewer Says | Author Says | Status |
|-----------|---------------|-------------|--------|
| Issue33340.cs:26 | Missing AutomationId on tabs | N/A | âš ï¸ INVESTIGATE |

**Author Uncertainty:**
- None noted

</details>

<details>
<summary><strong>ğŸ§ª Tests</strong></summary>

**Status**: âœ… COMPLETE

- [x] PR includes UI tests
- [x] Tests compile successfully
- [x] Tests follow naming convention (`Issue33340`)

**Test Files:**
- HostApp: `src/Controls/tests/TestCases.HostApp/Issues/Issue33340.cs`
- NUnit: `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/Issue33340.cs`

**Potential Issue:** Test uses `App.WaitForElement("Tab4")` but NavigationPage tabs don't have AutomationId set. May work via Title text matching but could be fragile.

</details>

<details>
<summary><strong>ğŸš¦ Gate - Test Verification</strong></summary>

**Status**: âœ… PASSED

- [x] Tests FAIL without fix, PASS with fix

**Result:** PASSED âœ…

**Verification Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              VERIFICATION PASSED âœ…                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Tests correctly detect the issue:                        â•‘
â•‘  - FAIL without fix (as expected)                         â•‘
â•‘  - PASS with fix (as expected)                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Platform Tested:** Android (emulator-5554, API 30)

</details>

<details>
<summary><strong>ğŸ”§ Fix Candidates</strong></summary>

**Status**: âœ… COMPLETE

| # | Source | Approach | Test Result | Files Changed | Notes |
|---|--------|----------|-------------|---------------|-------|
| 1 | try-fix | RequestApplyInsets in TabbedPageManager.OnPageSelected after tab switch | âœ… PASS | `TabbedPageManager.cs` (+6) | Works! Different location than PR - triggers inset recalc from tab change handler |
| 2 | try-fix | RequestApplyInsets only in ToolbarExtensions.UpdateIsVisible | âœ… PASS | `ToolbarExtensions.cs` (+1) | Works! Simpler but may not address secondary StatusBar color issue |
| PR | PR #33359 | RequestApplyInsets after toolbar layout update + reset appBarHasContent logic | âœ… PASS (Gate) | ToolbarExtensions.cs, MauiWindowInsetListener.cs | Original PR - addresses BOTH issues (NavigationBar overlap + StatusBar color reset) |

**Exhausted:** No (stopped after finding passing alternatives and comparing)

**Selected Fix:** PR's fix

**Reasoning:**
- Try-fix #2 is simpler (1 file vs 2) but only addresses the primary issue
- PR's fix addresses BOTH issues mentioned in the PR description:
  1. NavigationBar overlapping StatusBar (fixed by `RequestApplyInsets`)
  2. StatusBar color not resetting when returning to tab without NavigationBar (fixed by `appBarHasContent` logic reset)
- The additional complexity in PR is justified by the more complete fix
- All three approaches use the same core mechanism (`RequestApplyInsets`) - validating the approach

</details>

---

## ğŸ“‹ Final Report

### Summary

This PR fixes a regression introduced in PR #27294 where the NavigationBar overlaps the StatusBar in TabbedPage when tabs use mixed `HasNavigationBar` values. The fix is **correct, well-tested, and comprehensive**.

### Verification Results

| Check | Result |
|-------|--------|
| Tests FAIL without fix | âœ… Verified |
| Tests PASS with fix | âœ… Verified |
| Independent alternatives explored | âœ… 2 alternatives tested |
| Fix addresses root cause | âœ… Confirmed |

### Independent Analysis

I explored 2 independent fix approaches:

1. **TabbedPageManager approach** (+6 lines) - Works but different location
2. **ToolbarExtensions-only approach** (+1 line) - Simpler but incomplete

**Conclusion:** All approaches converge on `RequestApplyInsets` as the core mechanism. The PR's approach is the most comprehensive because it also fixes the secondary issue (StatusBar color not resetting) via the `appBarHasContent` logic change.

### Code Quality Assessment

| Aspect | Rating | Notes |
|--------|--------|-------|
| **Correctness** | âœ… Excellent | Fix directly addresses root cause |
| **Completeness** | âœ… Excellent | Addresses both primary and secondary issues |
| **Minimal Changes** | âœ… Good | Only 3 lines across 2 files |
| **Test Coverage** | âœ… Good | Screenshot-based UI test covers the scenario |
| **Pattern Consistency** | âœ… Excellent | `RequestApplyInsets` already used in 4+ places in codebase |

### Minor Suggestion (Non-blocking)

The test uses `App.WaitForElement("Tab4")` without explicit `AutomationId` on the tabs. This works via title text matching but could be made more explicit by adding `AutomationId` properties. This is a minor improvement and should not block merge.

### Recommendation

**âœ… APPROVE** - This PR should be merged.

The fix is:
- Minimal and surgical (3 lines)
- Correctly targets the root cause
- Well-tested with UI tests
- Follows established patterns in the codebase
- Comprehensive (fixes both reported issues)
