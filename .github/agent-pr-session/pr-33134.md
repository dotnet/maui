# PR Review: #33134 - [Android] EmptyView doesn't display when CollectionView is placed inside a VerticalStackLayout

**Date:** 2026-01-09 | **Issue:** [#32932](https://github.com/dotnet/maui/issues/32932) | **PR:** [#33134](https://github.com/dotnet/maui/pull/33134)

## ‚è≥ Status: IN PROGRESS

| Phase | Status |
|-------|--------|
| Pre-Flight | ‚úÖ COMPLETE |
| üß™ Tests | ‚úÖ COMPLETE |
| üö¶ Gate | ‚úÖ PASSED |
| üîß Fix | ‚ñ∂Ô∏è IN PROGRESS |
| üìã Report | ‚è≥ PENDING |

---

<details>
<summary><strong>üîß Fix Candidates</strong></summary>

**Status**: ‚ñ∂Ô∏è IN PROGRESS

| # | Source | Approach | Test Result | Files Changed | Notes |
|---|--------|----------|-------------|---------------|-------|
| 1 | try-fix | Fix at source in `EmptyViewAdapter.GetHeight()/GetWidth()` - return `double`, check `IsInfinity()` before casting | ‚úÖ PASS | `EmptyViewAdapter.cs` | Fixes bug at the source but changes method signatures |
| 2 | try-fix | Fix at source in `EmptyViewAdapter` - use `double` throughout + `Math.Abs` + infinity check | ‚úÖ PASS | `EmptyViewAdapter.cs` | Cleaner version of #1 but still changes method signatures |
| 3 | try-fix | **Avoid int.MaxValue entirely:** keep `GetHeight/GetWidth` as `int`, but change the lambdas passed to `SizedItemContentView`/`SimpleViewHolder` to return `double.PositiveInfinity` when `RecyclerViewHeight/Width` is infinite | ‚úÖ PASS | `EmptyViewAdapter.cs` (+4/-3) | Preserves infinity without signature changes and without magic-number checks; not defensive for other callers |
| 4 | try-fix | Check for infinity BEFORE casting in `GetHeight()`/`GetWidth()`, return 0 to trigger fallback | ‚ùå FAIL | `EmptyViewAdapter.cs` | **Why failed:** Fallback to `parent.MeasuredHeight` returns 0 during initial layout pass - doesn't provide valid dimensions |
| 5 | try-fix | Skip setting `RecyclerViewHeight/Width` when infinite | ‚ùå FAIL | `ItemsViewHandler.Android.cs` | **Why failed:** Same issue as #4 - fallback mechanism doesn't work when parent not yet measured |
| 6 | try-fix | Add `GetHeightAsDouble()`/`GetWidthAsDouble()` methods that return infinity when appropriate, use in `CreateEmptyViewHolder` lambdas | ‚úÖ PASS | `EmptyViewAdapter.cs` (+18) | Cleaner version of #3 with dedicated helper methods; fixes at source, no heuristic, no signature changes |
| PR | PR #33134 | Add `NormalizeDimension()` helper in `SizedItemContentView` that converts `int.MaxValue` ‚Üí `double.PositiveInfinity` | ‚úÖ PASS (Gate) | `SizedItemContentView.cs` | Defensive/low-risk downstream patch, but uses int.MaxValue heuristic |

### Key Insight from Failed Attempts

Attempts #4 and #5 revealed that:
- `(int)double.PositiveInfinity` in C# actually produces `int.MaxValue` (verified empirically)
- The fallback to `parent.MeasuredHeight` doesn't work during initial layout when parent hasn't been measured yet
- The solution must **preserve infinity semantics** rather than trying to fall back to measured values

### Candidate #3 and #6 Notes (Best Source-Level Fixes)

**What they fix:**
- Prevents `double.PositiveInfinity` from ever being cast to `int` in the EmptyView path.

**Why they're different from #1/#2:**
- No method signature changes (lower regression risk than #1/#2).
- No `int.MaxValue` heuristic (cleaner correctness than PR fix).

**#6 vs #3:**
- #6 uses dedicated helper methods (`GetHeightAsDouble`, `GetWidthAsDouble`) which is cleaner and more maintainable
- Both achieve the same result

**Downside vs PR fix:**
- Not defensive: only fixes this particular EmptyView adapter path; if some other code path feeds `int.MaxValue` into `SizedItemContentView`, PR fix would still be needed.

**Exhausted:** Yes (5 try-fix attempts completed)
**Selected Fix:** TBD - Compare #3/#6 (source-level) vs PR (defensive downstream)

</details>
