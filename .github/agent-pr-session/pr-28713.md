# PR Review: #28713 - [IOS] Inconsistent Resize Behavior for Header/Footer - fix

**Date:** 2026-01-14 | **Issue:** [#26397](https://github.com/dotnet/maui/issues/26397) | **PR:** [#28713](https://github.com/dotnet/maui/pull/28713)

## âœ… Status: GATE PASSED - Starting Fix Phase

| Phase | Status |
|-------|--------|
| Pre-Flight | âœ… COMPLETE |
| ğŸ§ª Tests | âœ… COMPLETE |
| ğŸš¦ Gate | âœ… PASSED |
| ğŸ”§ Fix | â–¶ï¸ IN PROGRESS |
| ğŸ“‹ Report | â³ PENDING |

---

<details>
<summary><strong>ğŸ“‹ Issue Summary</strong></summary>

**Issue #26397: Inconsistent Resize Behavior for Header/Footer on iOS/macOS**

When the "Resize Header/Footer" menu is tapped in a Shell Flyout, the sizes of the header and footer change, but they do not remain consistent across multiple taps. The resizing behavior is not predictable - sizes may vary each time rather than toggling between two consistent states.

**Steps to Reproduce:**
1. Run the sample app (HeaderFooterShellFlyoutSample.zip attached to issue)
2. Open the Flyout and tap the "Resize Header/Footer" menu
3. Observe that the header and footer resize
4. Tap the "Resize Header/Footer" menu again
5. Tap again and observe the size - it differs from the initial size

**Expected Behavior:**
Header and footer should toggle consistently between two sizes (small and large) on each tap, matching the behavior on Android.

**Platforms Affected:**
- [x] iOS
- [ ] Android (working correctly)
- [ ] Windows
- [x] MacCatalyst

**Regression Status:** Potential regression (not verified)

**Version:** 9.0.12 SR1.2

</details>

<details>
<summary><strong>ğŸ“ Files Changed</strong></summary>

| File | Type | Changes |
|------|------|---------|
| `src/Controls/src/Core/Compatibility/Handlers/Shell/iOS/ShellFlyoutHeaderContainer.cs` | Fix | +11 lines |
| `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/XFIssue/HeaderFooterShellFlyout.cs` | Test | +1/-2 lines |

**Fix Summary:**
- **ShellFlyoutHeaderContainer.cs**: Implements `IPlatformMeasureInvalidationController` interface to properly handle measure invalidation and update frame size when view size changes
- **HeaderFooterShellFlyout.cs**: Enables iOS platform for header/footer resize tests (was previously disabled for iOS)

</details>

<details>
<summary><strong>ğŸ’¬ PR Discussion Summary</strong></summary>

**Key Comments:**

1. **PureWeen (CHANGES_REQUESTED - 2025-03-30):**
   - Inline comment at `ShellFlyoutContentRenderer.cs:102`: "I think we're moving away from subscribing to measure invalidated subscriptions and using the propagation method that @albyrock87 created"
   - Author response: "No problem"
   - **Note:** This suggests a change in approach was requested

2. **Copilot Review (COMMENTED - 2025-03-30):**
   - Low confidence comment: Conditional compilation now includes iOS, suggest updating comment to clarify why
   - Low confidence comment: Possible duplicate event subscriptions or memory leak concern with _header MeasureInvalidated event

3. **Author (kubaflo) responded on 2025-04-02**

**Reviewer Feedback:**
- Review requested changes to use "propagation method" instead of MeasureInvalidated subscriptions
- Potential concerns about event subscription management

**Disagreements to Investigate:**
| File:Line | Reviewer Says | Author Says | Status |
|-----------|---------------|-------------|--------|
| ShellFlyoutContentRenderer.cs:102 | Use propagation method instead of MeasureInvalidated | No problem (agreed to change) | âš ï¸ INVESTIGATE - File no longer in PR diff |

**Author Uncertainty:**
- None explicitly stated

**Key Observation:**
The PR diff currently shows changes to `ShellFlyoutHeaderContainer.cs`, but the review comments reference `ShellFlyoutContentRenderer.cs`. This suggests the implementation approach was changed after the initial review - likely following PureWeen's feedback to use the propagation method.

</details>

<details>
<summary><strong>ğŸ§ª Tests</strong></summary>

**Status**: âœ… COMPLETE

- [x] PR includes UI tests (existing test modified)
- [x] Tests reproduce the issue (structure verified)
- [x] Tests follow naming convention (XFIssue naming used)

**Test Files:**
- HostApp: `src/Controls/tests/TestCases.HostApp/Issues/XFIssue/HeaderFooterShellFlyout.cs`
- NUnit: `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/XFIssue/HeaderFooterShellFlyout.cs`

**Test Description:**
The HostApp page creates a Shell with Flyout that has menu items to:
1. Toggle header/footer views
2. Toggle header/footer templates
3. **Resize header/footer** - Toggles between 60px and 200px heights

The NUnit test verifies that:
1. Headers/footers toggle correctly
2. Templates take priority over views
3. **Size changes are consistent** - After 3 resize taps, heights should alternate: small â†’ large â†’ small (matching initial)

**Test Change:**
Enables iOS platform tests for header/footer resize verification by changing conditional compilation from `#if ANDROID` to `#if ANDROID || IOS`.

**Before Fix:** iOS tests were disabled with comment referencing issue #26397
**After Fix:** iOS tests enabled, expecting consistent resize behavior

</details>

<details>
<summary><strong>ğŸš¦ Gate - Test Verification</strong></summary>

**Status**: âœ… PASSED

- [x] Tests FAIL without fix (bug reproduced)
- [x] Tests PASS with fix (bug resolved)

**Result:** âœ… **VERIFICATION PASSED**

**Verification Output:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              VERIFICATION PASSED âœ…                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Tests correctly detect the issue:                        â•‘
â•‘  - FAIL without fix (as expected)                         â•‘
â•‘  - PASS with fix (as expected)                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Test Behavior:**
- **WITHOUT fix** (reverted to `origin/main`): Tests **FAILED** âœ… (expected - bug reproduced)
- **WITH fix** (PR branch with compilation fix): Tests **PASSED** âœ… (expected - fix works)

**Platform Tested:** iOS (iPhone Xs, iOS 18.5)

**Test Filter:** `HeaderFooterShellFlyout`

**Fix Validated:** The compilation error was fixed (changed `InvalidateMeasure` return type from `void` to `bool`), and the PR's approach successfully resolves the inconsistent resize behavior.

</details>

<details>
<summary><strong>ğŸ”§ Fix Candidates</strong></summary>

**Status**: â³ PENDING

| # | Source | Approach | Test Result | Files Changed | Notes |
|---|--------|----------|-------------|---------------|-------|
| PR | PR #28713 | Implements `IPlatformMeasureInvalidationController` in `ShellFlyoutHeaderContainer` to handle measure invalidation via propagation method. When `InvalidateMeasure` is called, recalculates size with `SizeThatFits` and updates frame dimensions. | âœ… PASS (Gate) | `ShellFlyoutHeaderContainer.cs` (+11) | Original PR - validated by Gate, approach changed after review to use propagation method |

**Exhausted:** No
**Selected Fix:** [PENDING]

</details>

---

**Next Step:** âœ… Gate PASSED. Read `.github/agents/pr/post-gate.md` for Phase 4-5 instructions.
