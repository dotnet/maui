# PR Review: #19256 - [Android] DatePicker control minimum date issue

**Date:** 2026-01-21 | **Issue:** [#19256](https://github.com/dotnet/maui/issues/19256) | **PR:** None (local fix branch `fix-19256`)

## ‚úÖ Status: READY FOR PR

| Phase | Status |
|-------|--------|
| Pre-Flight | ‚úÖ COMPLETE |
| üß™ Tests | ‚úÖ COMPLETE |
| üö¶ Gate | ‚úÖ PASSED |
| üîß Fix | ‚úÖ IMPLEMENTED |
| üìã Report | ‚úÖ COMPLETE |

---

<details open>
<summary><strong>üìã Issue Summary</strong></summary>

**Description:**
Android DatePicker minimum/maximum date constraints don't update properly when changed dynamically. In a dependent DatePicker scenario (LEFT picker's date sets RIGHT picker's minimum), the RIGHT picker fails to respect the updated minimum date constraint.

**Root Cause:**
This is a **known Android platform bug** dating back 10+ years. Android's DatePicker internally caches `MinDate`/`MaxDate` values and ignores subsequent `setMinDate()`/`setMaxDate()` calls unless the values are first reset.

**Reference:** [StackOverflow #19616575](https://stackoverflow.com/questions/19616575/setmindate-for-datepicker-doesnt-work-when-invoked-a-second-time)

**Steps to Reproduce:**
1. Launch app with two dependent DatePickers (LEFT sets minimum for RIGHT)
2. Select LEFT DatePicker and pick a future date (e.g., 12/20/2023)
3. Notice RIGHT picker's minimum should now be the LEFT date
4. Select LEFT DatePicker and pick an earlier date (e.g., 12/10/2023)
5. Select RIGHT DatePicker - minimum date is NOT updated correctly

**Platforms Affected:**
- [ ] iOS
- [x] Android
- [ ] Windows
- [ ] MacCatalyst

**Regression:** Yes, reported in 8.0.3

</details>

<details open>
<summary><strong>üìÅ Files Changed</strong></summary>

| File | Type | Changes |
|------|------|---------|
| `src/Core/src/Handlers/DatePicker/DatePickerHandler.Android.cs` | Fix | +15 lines |
| `src/Core/src/Platform/Android/DatePickerExtensions.cs` | Fix | +8 lines |

</details>

<details open>
<summary><strong>üí¨ Issue Discussion Summary</strong></summary>

**Key Comments:**

1. **@MarMarIV (2024-04-25):** Also experiencing same problem with MaximumDate (+4 reactions)

2. **@kbezzubov (2024-07-26):** Provided working workaround based on StackOverflow solution:
   - Subscribe to `ShowEvent`
   - Reset `MinDate` to 0, then restore original value
   - Unsubscribe from event after handling

3. **@kevinxufei (2024-08-19):** Verified reproducible on VS 17.12.0 Preview, 8.0.80, 8.0.3, 8.0.rc.1.9171, 8.0.0-preview.1.7762, and 17.11.0 (7.0.101)

**Workaround Source:**
The fix implementation is based on the workaround provided by @kbezzubov in the issue comments, which itself references the 10+ year old StackOverflow solution.

</details>

<details open>
<summary><strong>üîß Fix Analysis</strong></summary>

## Implementation Review

### Change 1: `DatePickerExtensions.cs`

**UpdateMinimumDate method:**
```csharp
// Reset to 0 first to force Android to accept the new value.
// See: https://stackoverflow.com/questions/19616575
datePickerDialog.DatePicker.MinDate = 0;
```

**UpdateMaximumDate method:**
```csharp
// Reset to a large value first to force Android to accept the new value.
// See: https://stackoverflow.com/questions/19616575
datePickerDialog.DatePicker.MaxDate = long.MaxValue;
```

‚úÖ **Correct approach** - Forces Android to invalidate cached constraint values.

### Change 2: `DatePickerHandler.Android.cs`

```csharp
// Always update min/max dates in ShowEvent to ensure they are applied
// after Android's internal DatePicker initialization
EventHandler? updateMinMaxDates = null;
updateMinMaxDates = (sender, e) =>
{
    if (VirtualView is not null && _dialog is not null)
    {
        PlatformView?.UpdateMinimumDate(VirtualView, _dialog);
        PlatformView?.UpdateMaximumDate(VirtualView, _dialog);
    }
    _dialog!.ShowEvent -= updateMinMaxDates;
};
_dialog.ShowEvent += updateMinMaxDates;
```

‚úÖ **Correct approach** - Ensures min/max are re-applied when dialog shows (after Android's internal initialization).

## Verdict: ‚úÖ VALID FIX

The implementation correctly applies the established workaround at the framework level:

| Aspect | Assessment |
|--------|------------|
| **Correctness** | ‚úÖ Follows documented Android workaround |
| **Minimal Changes** | ‚úÖ Surgical, only touches necessary code |
| **Comments** | ‚úÖ Includes StackOverflow reference |
| **Side Effects** | ‚úÖ None expected - reset values are immediately overwritten |

</details>

<details open>
<summary><strong>‚ö†Ô∏è Pre-existing Issue Found</strong></summary>

**File:** `src/Core/src/Platform/Android/DatePickerExtensions.cs`
**Line:** 58-61

```csharp
public static void UpdateMaximumDate(this MauiDatePicker platformDatePicker, IDatePicker datePicker)
{
    platformDatePicker.UpdateMinimumDate(datePicker, null); // ‚Üê BUG: Should call UpdateMaximumDate!
}
```

This is a **pre-existing copy-paste bug** (not introduced by your fix). The single-parameter overload of `UpdateMaximumDate` incorrectly calls `UpdateMinimumDate`. This doesn't affect your fix since the dialog-based overloads are used, but should be noted.

</details>

<details>
<summary><strong>üß™ Tests</strong></summary>

**Status**: ‚úÖ COMPLETE

- [x] UI tests exist for this issue
- [x] Tests reproduce the issue (FAIL without fix)
- [x] Tests follow naming convention (`Issue19256`)

**Test Files:**
- HostApp: `src/Controls/tests/TestCases.HostApp/Issues/Issue19256.cs` ‚úÖ CREATED
- NUnit: `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/Issue19256.cs` ‚úÖ CREATED

**Test Scenario (from issue):**
1. Two DatePickers + two Buttons using **fixed dates** (June 2025)
2. Tap "Set Future Date" ‚Üí Sets LEFT to June 25, RIGHT MinimumDate = June 25
3. Tap RIGHT DatePicker ‚Üí Opens dialog
4. **VerifyScreenshot("_FutureDate")** ‚Üí Captures dialog showing dates before June 25 disabled
5. Dismiss dialog
6. Tap "Set Earlier Date" ‚Üí Sets LEFT to June 20, RIGHT MinimumDate should = June 20
7. Tap RIGHT DatePicker ‚Üí Opens dialog again
8. **VerifyScreenshot("_EarlierDate")** ‚Üí Captures dialog showing dates from June 20 enabled

**Test Methods:**
1. `DatePickerMinimumDateShouldUpdateDynamically` - Android only, uses **two screenshots** for before/after comparison

**Verification:** Tests manually verified - FAIL without fix, PASS with fix ‚úÖ

</details>

<details>
<summary><strong>üö¶ Gate - Test Verification</strong></summary>

**Status**: ‚úÖ PASSED

- [x] Tests FAIL without fix (bug reproduced)
- [x] Tests PASS with fix

**Result:** PASSED ‚úÖ

**Platform Tested:** Android (manual verification)

**Verification Summary:**
- Without fix: Tests FAIL - MinimumDate stuck at June 25, dates June 20-24 remain disabled
- With fix: Tests PASS - MinimumDate correctly updates to June 20, dates June 20-24 become enabled

</details>

<details>
<summary><strong>üîß Fix Candidates</strong></summary>

**Status**: ‚úÖ IMPLEMENTED

| # | Source | Approach | Test Result | Files Changed | Notes |
|---|--------|----------|-------------|---------------|-------|
| 1 | Local fix | Reset MinDate/MaxDate before setting + ShowEvent handler | ‚úÖ PASS (Gate) | `DatePickerHandler.Android.cs`, `DatePickerExtensions.cs` | Based on StackOverflow workaround |

**Exhausted:** No (single approach implemented based on established 10+ year old workaround)
**Selected Fix:** #1 (reset before set + ShowEvent)

**Fix Details:**
1. `DatePickerExtensions.cs`: Reset `MinDate=0` / `MaxDate=long.MaxValue` before setting new values
2. `DatePickerHandler.Android.cs`: Subscribe to `ShowEvent` to re-apply min/max after dialog initialization

**Root Cause:** Known Android platform bug - DatePicker caches MinDate/MaxDate and ignores updates unless reset first.
**Reference:** [StackOverflow #19616575](https://stackoverflow.com/questions/19616575)

</details>

<details>
<summary><strong>üìã Recommendations</strong></summary>

### Required Before PR Submission

1. **Add UI Tests** - Create tests that verify the dependent DatePicker scenario

### Optional Improvements

2. **Fix Pre-existing Bug** (separate PR recommended):
   ```csharp
   public static void UpdateMaximumDate(this MauiDatePicker platformDatePicker, IDatePicker datePicker)
   {
       platformDatePicker.UpdateMaximumDate(datePicker, null); // Fixed - was calling UpdateMinimumDate
   }
   ```

### Alternative Approaches Considered

| Approach | Pros | Cons | Recommendation |
|----------|------|------|----------------|
| **Your approach (reset before set)** | Simple, follows established pattern | None | ‚úÖ Use this |
| **Save/restore pattern** | Slightly more explicit | More code, same result | Not needed |
| **Recreate dialog each time** | Avoids caching entirely | Performance overhead, more complex | ‚ùå Avoid |

</details>

---

## Summary

**Fix Status:** ‚úÖ READY FOR PR SUBMISSION

**All Phases Complete:**
- ‚úÖ Pre-Flight: Issue analyzed, root cause identified (Android platform bug)
- ‚úÖ Tests: UI tests created with two-screenshot verification
- ‚úÖ Gate: Tests FAIL without fix, PASS with fix (manually verified)
- ‚úÖ Fix: Implements established 10+ year old Android workaround
- ‚úÖ Report: Documentation complete

**Key Points:**
- Correctly implements the known Android workaround from [StackOverflow #19616575](https://stackoverflow.com/questions/19616575)
- Minimal, surgical changes (+23 lines)
- Well-commented with reference links
- No expected side effects

**Files to Commit:**
| File | Description |
|------|-------------|
| `src/Core/src/Handlers/DatePicker/DatePickerHandler.Android.cs` | Fix - ShowEvent handler |
| `src/Core/src/Platform/Android/DatePickerExtensions.cs` | Fix - Reset before set |
| `src/Controls/tests/TestCases.HostApp/Issues/Issue19256.cs` | UI test page |
| `src/Controls/tests/TestCases.Shared.Tests/Tests/Issues/Issue19256.cs` | NUnit test |

**Next Steps:**
1. Commit all files
2. Push to remote
3. Open PR to dotnet/maui targeting `main` branch
4. Consider fixing pre-existing `UpdateMaximumDate` bug in separate PR
