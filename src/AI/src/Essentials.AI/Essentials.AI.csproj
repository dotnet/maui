<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>netstandard2.1;netstandard2.0;$(_MauiDotNetTfm);$(MauiEssentialsAIPlatforms)</TargetFrameworks>
    <TargetFrameworks Condition="'$(IncludePreviousTfmsEssentialsAI)' == 'true'">$(TargetFrameworks);$(_MauiPreviousDotNetTfm);$(MauiEssentialsAIPreviousPlatforms)</TargetFrameworks>
    <AssemblyName>Microsoft.Maui.Essentials.AI</AssemblyName>
    <RootNamespace>Microsoft.Maui.Essentials.AI</RootNamespace>
    <IsAotCompatible Condition="!$(TargetFramework.StartsWith('netstandard'))">true</IsAotCompatible>
    <AllowUnsafeBlocks Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">true</AllowUnsafeBlocks>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <IsBindingProject>true</IsBindingProject>
  </PropertyGroup>
  <PropertyGroup>
    <!-- NuGet package information -->
    <IsPackable>true</IsPackable>
    <PackageId>Microsoft.Maui.Essentials.AI</PackageId>
    <PackageTags>$(DefaultPackageTags);essentials;ai</PackageTags>
    <Description>.NET Multi-platform App UI (.NET MAUI) is a cross-platform framework for creating native mobile and desktop apps with C# and XAML. This package contains a collection of cross-platform APIs for working with device AI and local models.</Description>
  </PropertyGroup>
  <Import Project="$(MauiSrcDirectory)MultiTargeting.targets" />
  <ItemGroup>
    <PackageReference Include="Microsoft.Extensions.AI.Abstractions" />
    <PackageReference Include="Microsoft.Extensions.DependencyInjection.Abstractions" />
    <PackageReference Include="Microsoft.Extensions.Hosting.Abstractions" />
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" />
  </ItemGroup>
  <ItemGroup Condition=" $(TargetFramework.StartsWith('netstandard')) ">
    <Compile Remove="Platform\*.cs" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetPlatformIdentifier)' == 'android' ">
    <!-- <PackageReference Include="Xamarin.Google.MLKit.GenAI.Prompt" /> -->
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetPlatformIdentifier)' == 'ios' Or '$(TargetPlatformIdentifier)' == 'maccatalyst' Or '$(TargetPlatformIdentifier)' == 'macos' ">
    <XcodeProject Include="..\AppleNative\EssentialsAI.xcodeproj">
      <SchemeName>EssentialsAI</SchemeName>
    </XcodeProject>
    <ObjcBindingApiDefinition Include="Platform\MaciOS\ApiDefinitions.cs" />
    <ObjcBindingCoreSource Include="Platform\MaciOS\StructsAndEnums.cs" />
  </ItemGroup>
  <Import Project="$(MauiSrcDirectory)PublicAPI.targets" />
  <Import Project="$(MauiSrcDirectory)Workload\Shared\LibraryPacks.targets" />

  <!-- Some helpers for Intellisense -->
  <ItemGroup Condition=" '$(TargetPlatformIdentifier)' == 'ios'">
    <_FilesUsedForIntellisense Include="..\..\..\..\artifacts\obj\Essentials.AI\$(Configuration)\$(TargetFramework)\iOS\**\*.cs" Link="Platform\MaciOS\%(RecursiveDir)%(Filename)%(Extension)" Condition="Exists('..\..\..\..\artifacts\obj\Essentials.AI\$(Configuration)\$(TargetFramework)\iOS\ObjCRuntime\Messaging.g.cs')" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetPlatformIdentifier)' == 'maccatalyst'">
    <_FilesUsedForIntellisense Include="..\..\..\..\artifacts\obj\Essentials.AI\$(Configuration)\$(TargetFramework)\MacCatalyst\**\*.cs" Link="Platform\MaciOS\%(RecursiveDir)%(Filename)%(Extension)" Condition="Exists('..\..\..\..\artifacts\obj\Essentials.AI\$(Configuration)\$(TargetFramework)\MacCatalyst\ObjCRuntime\Messaging.g.cs')" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetPlatformIdentifier)' == 'ios' Or '$(TargetPlatformIdentifier)' == 'maccatalyst' Or '$(TargetPlatformIdentifier)' == 'macos' ">
    <_FilesUsedForIntellisense Include="Platform\MaciOS\StructsAndEnums.cs" />
    <Compile Include="@(_FilesUsedForIntellisense)" />
  </ItemGroup>
  <Target Name="RemoveGeneratedFiles" BeforeTargets="_CollectGeneratedSources" Condition=" '$(TargetPlatformIdentifier)' == 'ios' Or '$(TargetPlatformIdentifier)' == 'maccatalyst' Or '$(TargetPlatformIdentifier)' == 'macos' ">
    <ItemGroup>
      <Compile Remove="@(_FilesUsedForIntellisense)" />
    </ItemGroup>
  </Target>
</Project>
