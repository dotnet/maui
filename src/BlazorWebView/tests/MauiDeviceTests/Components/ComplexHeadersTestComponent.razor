@page "/complex-headers-test"
@inject IJSRuntime JSRuntime

<div id="result">Loading...</div>
<button id="testButton" @onclick="TestComplexHeaders">Test Complex Headers</button>

@code {
    private async Task TestComplexHeaders()
    {
        try
        {
            var script = @"
                fetch('/api/complex', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer token123',
                        'X-Custom-Header': 'CustomValue',
                        'Accept': 'application/json, text/plain, */*'
                    },
                    body: JSON.stringify({ test: 'data' })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('result').innerText = data.message;
                })
                .catch(error => {
                    document.getElementById('result').innerText = 'Error: ' + error;
                });
            ";
            
            await JSRuntime.InvokeVoidAsync("eval", script);
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("document.getElementById('result').innerText = 'Error: ' + arguments[0]", ex.Message);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await TestComplexHeaders();
        }
    }
}
