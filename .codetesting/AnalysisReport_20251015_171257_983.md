# Test Failures due possible code bugs

## SourceGen.UnitTests.csproj - Visit_ParentNodeNull_ThrowsNullReferenceException
- **Confidence**: High
- **Test File**: src/Controls/tests/SourceGen.UnitTests/Visitors/SetResourcesVisitorTests.cs
- **Bug Location**: src/Controls/src/SourceGen/Visitors/SetResourcesVisitor.cs@21

### Analysis
The test expects a NullReferenceException when parentNode is null, but the actual exception is ArgumentNullException. The issue is in the SetResourcesVisitor.Visit(ValueNode, INode) method at line 21. It directly casts parentNode to ElementNode without null checking: `((ElementNode)parentNode).IsResourceDictionary(Context)`. When parentNode is null, this creates a null ElementNode reference, and the subsequent call to IsResourceDictionary tries to use this null value as a dictionary key in `context.Variables.TryGetValue(node, out var variable)`, which throws ArgumentNullException instead of the expected NullReferenceException. The production code should use safe pattern matching like the other Visit methods in the same class.

### Suggested Fix
The SetResourcesVisitor.Visit(ValueNode, INode) method at line 21 should use safe pattern matching instead of direct casting. Change `if (!((ElementNode)parentNode).IsResourceDictionary(Context))` to `if (parentNode is not ElementNode elementParent || !elementParent.IsResourceDictionary(Context))` to handle null parentNode gracefully and return early without throwing an exception.

