parameters:
  jdkMajorVersion: 17

steps:
# Setup JDK Paths (gradle needs it)
- bash: |
    jdkPath=$(/usr/libexec/java_home -V 2>&1 | grep -E "${{ parameters.jdkMajorVersion }}.jdk" | head -n 1 | awk '{print $NF}')
    if [ -n "$jdkPath" ]; then
      echo "##vso[task.setvariable variable=JI_JAVA_HOME]$jdkPath"
      echo "##vso[task.setvariable variable=JAVA_HOME]$jdkPath"
      echo "JAVA_HOME set to '$jdkPath'"
    else
      echo "Unable to find JDK ${{ parameters.jdkMajorVersion }}"
      exit 1
    fi
  displayName: Setup JDK ${{ parameters.jdkMajorVersion }} Paths
  condition: and(succeeded(), eq(variables['Agent.OS'], 'Darwin'))

- pwsh: |
    $path = (Get-ChildItem $env:ProgramFiles\Microsoft\jdk-${{ parameters.jdkMajorVersion }}.*\bin\java.exe) | Select-Object -First 1
    if ($path -and (Test-Path $path)) {
      $env:JAVA_HOME = $path.Directory.Parent.FullName
    }
    
    if ($env:JAVA_HOME) {
      echo "##vso[task.setvariable variable=JAVA_HOME]$env:JAVA_HOME"
      echo "JAVA_HOME set to '$env:JAVA_HOME'"
    } else {
      echo "Unable to set JAVA_HOME"
    }
  displayName: Setup JDK ${{ parameters.jdkMajorVersion }} Paths
  condition: and(succeeded(), eq(variables['Agent.OS'], 'Windows_NT'))
